<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zach Wagner">
<meta name="dcterms.date" content="2023-09-21">
<meta name="description" content="We use a neural network and polynomial regression to solve the heat equation and compare the results qualitatively.">

<title>Zach Wagner - Simple ML Architectures to Solve the Heat Equation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Zach Wagner</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Teaching.html" rel="" target="">
 <span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#heat-equation" id="toc-heat-equation" class="nav-link active" data-scroll-target="#heat-equation">Heat Equation</a>
  <ul class="collapse">
  <li><a href="#simple-neural-network-solution" id="toc-simple-neural-network-solution" class="nav-link" data-scroll-target="#simple-neural-network-solution">Simple Neural Network Solution</a></li>
  <li><a href="#polynomial-regression-solution" id="toc-polynomial-regression-solution" class="nav-link" data-scroll-target="#polynomial-regression-solution">Polynomial regression solution</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Simple ML Architectures to Solve the Heat Equation</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Partial Differential Equations</div>
    <div class="quarto-category">Machine Learning</div>
  </div>
  </div>

<div>
  <div class="description">
    We use a neural network and polynomial regression to solve the heat equation and compare the results qualitatively.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zach Wagner </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 21, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>I decided to try messing with the heat equation in my exploration of using ML to solve PDEs (and take a break from the Poisson equation). The equation itself is simple, as are the architectures I use to solve the equation, but this experiment proved interesting nonetheless. In particular, I found that the accuracy of the solution had more to do with the number and quality of the features I included for input than the architecture itself. I’ll elaborate upon what I mean below.</p>
<section id="heat-equation" class="level2">
<h2 class="anchored" data-anchor-id="heat-equation">Heat Equation</h2>
<p>I was motivated to solve the heat equation partially because of the nice visualizations that arise from a solution. I include an animation at the end of each solution I describe below. Unfortunately it can only run if the cell is executed; I’m having some environmental issues generating animations that play in-browser that I’ll troubleshoot later. Here’s the rendition of the heat equation I consider:</p>
<p><span class="math display">\[
\begin{alignat*}{2}
&amp; u_t(x,y,t)=\Delta_{(x,y)} u(x,y,t) &amp;&amp; (x,y)\in B_1(0), t&gt;0\\
&amp; u(x,y,t)=0 &amp;&amp; (x,y)\in\partial B_1(0), t\geq 0\\
&amp; u(x,y,0)=\exp\left(-\frac{1}{1-(x^2+y^2)}\right) &amp;&amp; (x,y)\in B_1(0)
\end{alignat*}
\]</span></p>
<p>for <span class="math inline">\(B_1(0)\subset\mathbb{R}^2\)</span>. The bump function makes for a particularly nice set of solutions to illustrate. The solution decays quickly, so we will only simulate it for a small period of time.</p>
<section id="simple-neural-network-solution" class="level3">
<h3 class="anchored" data-anchor-id="simple-neural-network-solution">Simple Neural Network Solution</h3>
<p>First, I will use a simple neural network with a single hidden layer. It doesn’t need to be very wide to get pretty good convergence to the solution. Here’s the architecture I use:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, clear_output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NeuralNetwork(nn.Module):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sequential_model <span class="op">=</span> nn.Sequential(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">3</span>, <span class="dv">8</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>            nn.Sigmoid(),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">8</span>, <span class="dv">1</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.sequential_model(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below is my data sampler function, simililar to the data sampler I used in my post on the Poisson equation. I sample 10000 points in my example and proceed to solve the equation for <span class="math inline">\(t\in\left[0,0.09\right]\)</span>.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SampleFromUnitBall(points):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> torch.distributions.Uniform(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    d_t <span class="op">=</span> torch.distributions.Uniform(<span class="dv">0</span>,<span class="fl">0.1</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> torch.Tensor(points,<span class="dv">1</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> torch.Tensor(points,<span class="dv">1</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> torch.Tensor(points,<span class="dv">1</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    j<span class="op">=</span><span class="dv">0</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    k<span class="op">=</span><span class="dv">0</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> j<span class="op">&lt;</span>points:</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        x_temp <span class="op">=</span> d.sample()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        y_temp <span class="op">=</span> d.sample()</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        t_temp <span class="op">=</span> d_t.sample()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x_temp<span class="op">**</span><span class="dv">2</span><span class="op">+</span>y_temp<span class="op">**</span><span class="dv">2</span><span class="op">&lt;</span><span class="dv">1</span> <span class="kw">and</span> t_temp<span class="op">!=</span><span class="dv">0</span>:</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            x[j,<span class="dv">0</span>]<span class="op">=</span>x_temp</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            y[j,<span class="dv">0</span>]<span class="op">=</span>y_temp</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>            t[j,<span class="dv">0</span>]<span class="op">=</span>k<span class="op">*</span><span class="dv">1</span><span class="op">/</span>(<span class="dv">10</span><span class="op">*</span>points)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>            j<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j<span class="op">%</span><span class="dv">1000</span><span class="op">==</span><span class="dv">0</span> <span class="kw">and</span> j<span class="op">!=</span><span class="dv">0</span>:</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                k<span class="op">+=</span><span class="dv">1000</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    xbdry <span class="op">=</span> torch.Tensor(points,<span class="dv">1</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    ybdry <span class="op">=</span> torch.Tensor(points,<span class="dv">1</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    tbdry <span class="op">=</span> torch.zeros(x.size(<span class="dv">0</span>)).unsqueeze(<span class="dv">1</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    j<span class="op">=</span><span class="dv">0</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> j<span class="op">&lt;</span>points:</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        x_temp <span class="op">=</span> d.sample()</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        xbdry[j,<span class="dv">0</span>]<span class="op">=</span>x_temp</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> j<span class="op">%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>            ybdry[j,<span class="dv">0</span>]<span class="op">=</span>math.sqrt(<span class="dv">1</span><span class="op">-</span>x_temp<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>            ybdry[j,<span class="dv">0</span>]<span class="op">=-</span>math.sqrt(<span class="dv">1</span><span class="op">-</span>x_temp<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        j<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x, y, t, xbdry, ybdry, tbdry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>x, y, t, xbdry, ybdry, tbdry <span class="op">=</span> SampleFromUnitBall(<span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The loss function is very similar to what we used in our Poisson solver. Again, I use a discrete mean-squared error function to compute the loss. In this case, I want to minimize the following,</p>
<p><span class="math display">\[L(x_{\text{int}},y_\text{int}, x_{\text{bdry}},y_{\text{bdry}}, t_{&gt;0}):=\frac{1}{N_{\text{int}}}\sum_{j=1}^{N_{\text{int}}}|\Delta u(x^{(j)}_{\text{int}},y^{(j)}_{\text{int}}, t^{(j)}_{&gt;0})-u(x^{(j)}_{\text{int}},y^{(j)}_{\text{int}}, t^{(j)}_{&gt;0})|^2
\]</span> <span class="math display">\[
+\frac{1}{N_{\text{bdry}}}\sum_{j=1}^{N_{\text{bdry}}}|u(x^{(j)}_{\text{bdry}},y^{(j)}_{\text{bdry}},t^{(j)}_{&gt;0})|^2+\frac{1}{N_{\text{int}}}\sum_{j=1}^{N_{\text{int}}}|u(x^{(j)}_{\text{int}},y^{(j)}_{\text{int}},0)-g(x^{(j)}_{\text{int}},y^{(j)}_{\text{int}})|^2
\]</span></p>
<p>where <span class="math inline">\(g(x,y):=\exp\left(-\frac{1}{1-(x^2+y^2)}\right)\)</span>.</p>
<p>To implement this loss function, I use the following code:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> g(x,y):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.exp(<span class="op">-</span><span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>(x<span class="op">**</span><span class="dv">2</span><span class="op">+</span>y<span class="op">**</span><span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loss(x, y, t, xbdry, ybdry, tbdry, network):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    x.requires_grad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    y.requires_grad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    t.requires_grad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    temp_input <span class="op">=</span> torch.cat((x,y,t),<span class="dv">1</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    w<span class="op">=</span>network(temp_input)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    temp_input_init <span class="op">=</span> torch.cat((x,y,tbdry),<span class="dv">1</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    w_init <span class="op">=</span> network(temp_input_init)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    wbdry <span class="op">=</span> network(torch.cat((xbdry, ybdry, t),<span class="dv">1</span>))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    dw_dx <span class="op">=</span> torch.autograd.grad(w.<span class="bu">sum</span>(), x, create_graph <span class="op">=</span> <span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    ddw_ddx <span class="op">=</span> torch.autograd.grad(dw_dx.<span class="bu">sum</span>(), x, create_graph <span class="op">=</span> <span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    dw_dy <span class="op">=</span> torch.autograd.grad(w.<span class="bu">sum</span>(), y, create_graph <span class="op">=</span> <span class="va">True</span>)[<span class="dv">0</span>] </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    ddw_ddy <span class="op">=</span> torch.autograd.grad(dw_dy.<span class="bu">sum</span>(), y, create_graph <span class="op">=</span> <span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    dw_dt <span class="op">=</span> torch.autograd.grad(w.<span class="bu">sum</span>(), t, create_graph <span class="op">=</span> <span class="va">True</span>)[<span class="dv">0</span>] </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> torch.mean((dw_dt <span class="op">-</span> (ddw_ddx<span class="op">+</span>ddw_ddy))<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> torch.mean((w_init<span class="op">-</span>g(x,y))<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> torch.mean((wbdry)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A<span class="op">+</span>B<span class="op">+</span>C</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I train the network. I use 100000 epochs to get pretty good convergence.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> NeuralNetwork()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.SGD(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>, momentum<span class="op">=</span><span class="fl">.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">100000</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>loss_values <span class="op">=</span> np.zeros(<span class="dv">100000</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> loss(x, y, t, xbdry, ybdry, tbdry, model)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    l.backward()</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    loss_values[i]<span class="op">=</span>l</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i<span class="op">%</span><span class="dv">1000</span><span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Loss at epoch </span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(i, l.item()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss at epoch 0: 0.2738669812679291
Loss at epoch 1000: 0.025970257818698883
Loss at epoch 2000: 0.02568979375064373
Loss at epoch 3000: 0.025230783969163895
Loss at epoch 4000: 0.024398991838097572
Loss at epoch 5000: 0.022912777960300446
Loss at epoch 6000: 0.02087295800447464
Loss at epoch 7000: 0.018625637516379356
Loss at epoch 8000: 0.015907008200883865
Loss at epoch 9000: 0.013540136627852917
Loss at epoch 10000: 0.012002145871520042
Loss at epoch 11000: 0.010946547612547874
Loss at epoch 12000: 0.01010743249207735
Loss at epoch 13000: 0.0094174575060606
Loss at epoch 14000: 0.008831574581563473
Loss at epoch 15000: 0.008312895894050598
Loss at epoch 16000: 0.007835050113499165
Loss at epoch 17000: 0.0073796845972537994
Loss at epoch 18000: 0.00693441741168499
Loss at epoch 19000: 0.006492464803159237
Loss at epoch 20000: 0.006053541321307421
Loss at epoch 21000: 0.0056252810172736645
Loss at epoch 22000: 0.0052236150950193405
Loss at epoch 23000: 0.004869983531534672
Loss at epoch 24000: 0.004583843518048525
Loss at epoch 25000: 0.004373359493911266
Loss at epoch 26000: 0.004231602419167757
Loss at epoch 27000: 0.004141609184443951
Loss at epoch 28000: 0.004085080698132515
Loss at epoch 29000: 0.004047917202115059
Loss at epoch 30000: 0.004021293483674526
Loss at epoch 31000: 0.00400038855150342
Loss at epoch 32000: 0.003982786554843187
Loss at epoch 33000: 0.0039673191495239735
Loss at epoch 34000: 0.003953419625759125
Loss at epoch 35000: 0.00394078902900219
Loss at epoch 36000: 0.003929249942302704
Loss at epoch 37000: 0.003918683156371117
Loss at epoch 38000: 0.003908993676304817
Loss at epoch 39000: 0.0039000948891043663
Loss at epoch 40000: 0.003891912754625082
Loss at epoch 41000: 0.0038843746297061443
Loss at epoch 42000: 0.0038774253334850073
Loss at epoch 43000: 0.0038710092194378376
Loss at epoch 44000: 0.0038650608621537685
Loss at epoch 45000: 0.003859535790979862
Loss at epoch 46000: 0.003854390000924468
Loss at epoch 47000: 0.003849589265882969
Loss at epoch 48000: 0.00384509633295238
Loss at epoch 49000: 0.0038408783730119467
Loss at epoch 50000: 0.0038368944078683853
Loss at epoch 51000: 0.0038331307005137205
Loss at epoch 52000: 0.0038295662961900234
Loss at epoch 53000: 0.003826176282018423
Loss at epoch 54000: 0.0038229411002248526
Loss at epoch 55000: 0.003819849109277129
Loss at epoch 56000: 0.0038168805185705423
Loss at epoch 57000: 0.0038140309043228626
Loss at epoch 58000: 0.0038112876936793327
Loss at epoch 59000: 0.0038086404092609882
Loss at epoch 60000: 0.0038060781080275774
Loss at epoch 61000: 0.003803590778261423
Loss at epoch 62000: 0.003801171202212572
Loss at epoch 63000: 0.0037988254334777594
Loss at epoch 64000: 0.0037965471856296062
Loss at epoch 65000: 0.003794319462031126
Loss at epoch 66000: 0.0037921415641903877
Loss at epoch 67000: 0.0037900148890912533
Loss at epoch 68000: 0.003787929890677333
Loss at epoch 69000: 0.003785883542150259
Loss at epoch 70000: 0.003783881664276123
Loss at epoch 71000: 0.003781920066103339
Loss at epoch 72000: 0.0037799954880028963
Loss at epoch 73000: 0.0037781083956360817
Loss at epoch 74000: 0.003776250407099724
Loss at epoch 75000: 0.00377441942691803
Loss at epoch 76000: 0.0037726142909377813
Loss at epoch 77000: 0.0037708329036831856
Loss at epoch 78000: 0.0037690771277993917
Loss at epoch 79000: 0.003767352784052491
Loss at epoch 80000: 0.003765658475458622
Loss at epoch 81000: 0.003763986984267831
Loss at epoch 82000: 0.0037623357493430376
Loss at epoch 83000: 0.0037607017438858747
Loss at epoch 84000: 0.003759087296202779
Loss at epoch 85000: 0.0037574912421405315
Loss at epoch 86000: 0.003755920333787799
Loss at epoch 87000: 0.0037543680518865585
Loss at epoch 88000: 0.0037528336979448795
Loss at epoch 89000: 0.0037513161078095436
Loss at epoch 90000: 0.0037498222663998604
Loss at epoch 91000: 0.0037483531050384045
Loss at epoch 92000: 0.0037469009403139353
Loss at epoch 93000: 0.0037454627454280853
Loss at epoch 94000: 0.003744041081517935
Loss at epoch 95000: 0.003742641070857644
Loss at epoch 96000: 0.0037412564270198345
Loss at epoch 97000: 0.003739887848496437
Loss at epoch 98000: 0.0037385355681180954
Loss at epoch 99000: 0.003737200517207384</code></pre>
</div>
</div>
<p>Evidently, one doesn’t need many input features, nor does one need a very wide network to get pretty good convergence. Moreover, I demonstrate the heat flow in the unit circle using the following plots and animation. Here, I’ve plotted a few instances of the solution over test data and three points in time in <span class="math inline">\(\left[0,0.09\right]\)</span>. Brighter colored scatter points indicate a higher value for <span class="math inline">\(u(x,y,t)\)</span>. As expected, the maximum value for <span class="math inline">\(u(x,y,t)\)</span> decreases as time progresses, and the heat diffuses to be nearly constant.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>x_test, y_test, z_test, xbdry_test, ybdry_test, zbdry_test <span class="op">=</span> SampleFromUnitBall(<span class="dv">10000</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_points(time_index):</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        temp_input <span class="op">=</span> torch.cat((x_test,y_test,torch.ones(<span class="dv">10000</span>).unsqueeze(<span class="dv">1</span>)<span class="op">*</span>time_index<span class="op">/</span><span class="dv">100</span>),<span class="dv">1</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        soln<span class="op">=</span>model(temp_input)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    plt.scatter(x<span class="op">=</span>x_test.detach(),y<span class="op">=</span>y_test.detach(),c<span class="op">=</span>soln.detach(), vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Solution at time index "</span> <span class="op">+</span> <span class="bu">str</span>(time_index))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"x-axis"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"y-axis"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>plot_points(<span class="dv">0</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>plot_points(<span class="dv">3</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>plot_points(<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Heat Equation_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Heat Equation_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Heat Equation_files/figure-html/cell-10-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>Running the cell below generates an animation of the solutions over time. I can even project the solutions past <span class="math inline">\(t=0.09\)</span> to show that the heat diffusion is accurately captured past our sample times.</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>x_test, y_test, z_test, xbdry_test, ybdry_test, zbdry_test <span class="op">=</span> SampleFromUnitBall(<span class="dv">10000</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        temp_input <span class="op">=</span> torch.cat((x_test,y_test,torch.ones(<span class="dv">10000</span>).unsqueeze(<span class="dv">1</span>)<span class="op">*</span>k<span class="op">/</span><span class="dv">100</span>),<span class="dv">1</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        soln<span class="op">=</span>model(temp_input)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    ax.cla()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    ax.scatter(x<span class="op">=</span>x_test.detach(),y<span class="op">=</span>y_test.detach(),c<span class="op">=</span>soln.detach(), vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    display(fig)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    clear_output(wait <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    plt.pause(<span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Heat Equation_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="polynomial-regression-solution" class="level3">
<h3 class="anchored" data-anchor-id="polynomial-regression-solution">Polynomial regression solution</h3>
<p>Now, I sample a new set of points and construct a “neural network” which actually allows me to run polynomial regression using my loss function. I show that a degree four polynomial in the input features is suitable for an accurate approximation to a solution of the problem. Here, I take advantage of the fact that the initial condition is radial in its input and admits a nice Taylor expansion in the radial coordinate <span class="math inline">\(r^2=x^2+y^2\)</span>. Hence, an accurate approximation of the initial condition may be obtained by using a low-degree polynomial. Interestingly, even though the Taylor series only contains even powers of <span class="math inline">\(r\)</span>, including all odd degree terms seemed to improve convergence. Furthermore, the polynomial approximation converges much more rapidly to the actual solution than the nueral network. Essentially, the polynomial approximation contains far more “useful” features than the simple coordinate and time input features I used in the neural network input.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>x, y, t, xbdry, ybdry, tbdry <span class="op">=</span> SampleFromUnitBall(<span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NeuralNetwork2(nn.Module):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sequential_model <span class="op">=</span> nn.Sequential(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">32</span>, <span class="dv">1</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.sequential_model(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The loss function is really ugly since I need to compute all polynomial features and their derivatives. I wanted to use scikit-learn’s polynomial feature class, but this destroyed the derivative data in my tensors, so I’d have to create a polynomial feature class from scratch. I might do this in the future, but for now everything is hardcoded.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loss2(x, y, t, xbdry, ybdry, tbdry, network):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    x.requires_grad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    y.requires_grad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    t.requires_grad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Here come all of the polynomial features....</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    x_2 <span class="op">=</span> x<span class="op">**</span><span class="dv">2</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    y_2 <span class="op">=</span> y<span class="op">**</span><span class="dv">2</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    x_3 <span class="op">=</span> x<span class="op">**</span><span class="dv">3</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    y_3 <span class="op">=</span> y<span class="op">**</span><span class="dv">3</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    x_4 <span class="op">=</span> x<span class="op">**</span><span class="dv">4</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    y_4 <span class="op">=</span> y<span class="op">**</span><span class="dv">4</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    xy_2 <span class="op">=</span> x<span class="op">*</span>(y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    x_2y <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>y</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    xyt <span class="op">=</span> x<span class="op">*</span>y<span class="op">*</span>t</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    x_2t <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>t</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    y_2t <span class="op">=</span> (y<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>t</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    t_3 <span class="op">=</span> t<span class="op">**</span><span class="dv">3</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    t_4 <span class="op">=</span> t<span class="op">**</span><span class="dv">4</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    x_3y <span class="op">=</span> (x<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>y</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    xy_3 <span class="op">=</span> x<span class="op">*</span>(y<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    x_2y_2 <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    x_3t <span class="op">=</span> (x<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>t</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    x_2t_2 <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(t<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    xt_3 <span class="op">=</span> x<span class="op">*</span>(t<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    y_3t <span class="op">=</span> (y<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>t</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    y_2t_2 <span class="op">=</span> (y<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(t<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    yt_3 <span class="op">=</span> y<span class="op">*</span>(t<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    xyt_2 <span class="op">=</span> x<span class="op">*</span>y<span class="op">*</span>(t<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    xy_2t <span class="op">=</span> x<span class="op">*</span>(y<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>t</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    x_2yt <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>y<span class="op">*</span>t</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    xy <span class="op">=</span> x<span class="op">*</span>y</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    t_2 <span class="op">=</span> t<span class="op">**</span><span class="dv">2</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    xt <span class="op">=</span> x<span class="op">*</span>t</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    yt <span class="op">=</span> y<span class="op">*</span>t</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    xbdry_2 <span class="op">=</span> xbdry<span class="op">**</span><span class="dv">2</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    ybdry_2 <span class="op">=</span> ybdry<span class="op">**</span><span class="dv">2</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    xbdry_3 <span class="op">=</span> xbdry<span class="op">**</span><span class="dv">3</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    ybdry_3 <span class="op">=</span> ybdry<span class="op">**</span><span class="dv">3</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    xbdry_4 <span class="op">=</span> xbdry<span class="op">**</span><span class="dv">4</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    ybdry_4 <span class="op">=</span> ybdry<span class="op">**</span><span class="dv">4</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    xbdryybdry_2 <span class="op">=</span> xbdry<span class="op">*</span>(ybdry<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    xbdry_2ybdry <span class="op">=</span> (xbdry<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>ybdry</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    xbdryybdryt <span class="op">=</span> xbdry<span class="op">*</span>ybdry<span class="op">*</span>t</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    xbdry_2t <span class="op">=</span> (xbdry<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>t</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    ybdry_2t <span class="op">=</span> (ybdry<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>t</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    xbdry_ybdry <span class="op">=</span> xbdry<span class="op">*</span>ybdry</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    tbdry_2 <span class="op">=</span> tbdry<span class="op">**</span><span class="dv">2</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    xbdry_t<span class="op">=</span> xbdry<span class="op">*</span>t</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    ybdry_t <span class="op">=</span> ybdry<span class="op">*</span>t</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    x_tbdry <span class="op">=</span> x<span class="op">*</span>tbdry</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    y_tbdry <span class="op">=</span> y<span class="op">*</span>tbdry</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    xytbdry <span class="op">=</span> x<span class="op">*</span>y<span class="op">*</span>tbdry</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    x_2tbdry <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>tbdry</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    y_2tbdry <span class="op">=</span> (y<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>tbdry</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    tbdry_3 <span class="op">=</span> tbdry<span class="op">**</span><span class="dv">3</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    tbdry_4 <span class="op">=</span> tbdry<span class="op">**</span><span class="dv">4</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    xbdry_3ybdry <span class="op">=</span> (xbdry<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>ybdry</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    xbdryybdry_3 <span class="op">=</span> xbdry<span class="op">*</span>(ybdry<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    xbdry_2ybdry_2 <span class="op">=</span> (xbdry<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(ybdry<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    xbdry_3t <span class="op">=</span> (xbdry<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>t</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    xbdry_2t_2 <span class="op">=</span> (xbdry<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(t<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    xbdryt_3 <span class="op">=</span> xbdry<span class="op">*</span>(t<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    ybdry_3t <span class="op">=</span> (ybdry<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>t</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    ybdry_2t_2 <span class="op">=</span> (ybdry<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(t<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    ybdryt_3 <span class="op">=</span> ybdry<span class="op">*</span>(t<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    x_3tbdry <span class="op">=</span> (x<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>tbdry</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>    x_2tbdry_2 <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(tbdry<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>    xtbdry_3 <span class="op">=</span> x<span class="op">*</span>(tbdry<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    y_3tbdry <span class="op">=</span> (y<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>tbdry</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>    y_2tbdry_2 <span class="op">=</span> (y<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(tbdry<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    ytbdry_3 <span class="op">=</span> y<span class="op">*</span>(tbdry<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    xbdryybdryt_2 <span class="op">=</span> xbdry<span class="op">*</span>ybdry<span class="op">*</span>(t<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    xbdryybdry_2t <span class="op">=</span> xbdry<span class="op">*</span>(ybdry<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>t</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    xbdry_2ybdryt <span class="op">=</span> (xbdry<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>ybdry<span class="op">*</span>t  </span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>    xytbdry_2 <span class="op">=</span> x<span class="op">*</span>y<span class="op">*</span>(tbdry<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>    xy_2tbdry <span class="op">=</span> x<span class="op">*</span>(y<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>tbdry</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>    x_2ytbdry <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>y<span class="op">*</span>tbdry</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>    <span class="co">##End of polynomial features</span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>    temp_input <span class="op">=</span> torch.cat((x,y,t,x_2,y_2,xy,t_2,xt,yt,x_4,y_4,t_4,x_3y,xy_3,x_2y_2,x_3t,x_2t_2,xt_3,y_3t,y_2t_2,yt_3,xyt_2,xy_2t,x_2yt,x_3,y_3,xy_2,x_2y,xyt,x_2t,y_2t,t_3),<span class="dv">1</span>)</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    w<span class="op">=</span>network(temp_input)</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>    temp_input_init <span class="op">=</span> torch.cat((x,y,tbdry,x_2,y_2,xy,tbdry_2,x_tbdry,y_tbdry,x_4,y_4,tbdry_4,x_3y,xy_3,x_2y_2,x_3tbdry,x_2tbdry_2,xtbdry_3,y_3tbdry,y_2tbdry_2,ytbdry_3,xytbdry_2,xy_2tbdry,x_2ytbdry,x_3,y_3,xy_2,x_2y,xytbdry,x_2tbdry,y_2tbdry,tbdry_3),<span class="dv">1</span>)</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    w_init <span class="op">=</span> network(temp_input_init)</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>    wbdry <span class="op">=</span> network(torch.cat((xbdry, ybdry, t,xbdry_2,ybdry_2,xbdry_ybdry,t_2,xbdry_t,ybdry_t,xbdry_4,ybdry_4,t_4,xbdry_3ybdry,xbdryybdry_3,xbdry_2ybdry_2,xbdry_3t,xbdry_2t_2,xbdryt_3,ybdry_3t,ybdry_2t_2,ybdryt_3,xbdryybdryt_2,xbdryybdry_2t,xbdry_2ybdryt,xbdry_3,ybdry_3,xbdryybdry_2,xbdry_2ybdry,xbdryybdryt,xbdry_2t,ybdry_2t,t_3),<span class="dv">1</span>))</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    dw_dx <span class="op">=</span> torch.autograd.grad(w.<span class="bu">sum</span>(), x, create_graph <span class="op">=</span> <span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    ddw_ddx <span class="op">=</span> torch.autograd.grad(dw_dx.<span class="bu">sum</span>(), x, create_graph <span class="op">=</span> <span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    dw_dy <span class="op">=</span> torch.autograd.grad(w.<span class="bu">sum</span>(), y, create_graph <span class="op">=</span> <span class="va">True</span>)[<span class="dv">0</span>] </span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    ddw_ddy <span class="op">=</span> torch.autograd.grad(dw_dy.<span class="bu">sum</span>(), y, create_graph <span class="op">=</span> <span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>    dw_dt <span class="op">=</span> torch.autograd.grad(w.<span class="bu">sum</span>(), t, create_graph <span class="op">=</span> <span class="va">True</span>)[<span class="dv">0</span>] </span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> torch.mean((dw_dt <span class="op">-</span> (ddw_ddx<span class="op">+</span>ddw_ddy))<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> torch.mean((w_init<span class="op">-</span>g(x,y))<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> torch.mean((wbdry)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print("Loss for each item: {}, {}, {}".format(A,B,C))</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A<span class="op">+</span>B<span class="op">+</span>C</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below, I define a helper function for computing values the network generates from input data. It computes all of the needed polynomial features before supplying them into the network.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> network_value(x, y, t, network):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    x_2 <span class="op">=</span> x<span class="op">**</span><span class="dv">2</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    y_2 <span class="op">=</span> y<span class="op">**</span><span class="dv">2</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    x_3 <span class="op">=</span> x<span class="op">**</span><span class="dv">3</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    y_3 <span class="op">=</span> y<span class="op">**</span><span class="dv">3</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    x_4 <span class="op">=</span> x<span class="op">**</span><span class="dv">4</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    y_4 <span class="op">=</span> y<span class="op">**</span><span class="dv">4</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    xy_2 <span class="op">=</span> x<span class="op">*</span>(y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    x_2y <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>y</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    xyt <span class="op">=</span> x<span class="op">*</span>y<span class="op">*</span>t</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    x_2t <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>t</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    y_2t <span class="op">=</span> (y<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>t</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    t_3 <span class="op">=</span> t<span class="op">**</span><span class="dv">3</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    t_4 <span class="op">=</span> t<span class="op">**</span><span class="dv">4</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    xy <span class="op">=</span> x<span class="op">*</span>y</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    t_2 <span class="op">=</span> t<span class="op">**</span><span class="dv">2</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    xt <span class="op">=</span> x<span class="op">*</span>t</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    yt <span class="op">=</span> y<span class="op">*</span>t</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    x_3y <span class="op">=</span> (x<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>y</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    xy_3 <span class="op">=</span> x<span class="op">*</span>(y<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    x_2y_2 <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    x_3t <span class="op">=</span> (x<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>t</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    x_2t_2 <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(t<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    xt_3 <span class="op">=</span> x<span class="op">*</span>(t<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    y_3t <span class="op">=</span> (y<span class="op">**</span><span class="dv">3</span>)<span class="op">*</span>t</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    y_2t_2 <span class="op">=</span> (y<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>(t<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    yt_3 <span class="op">=</span> y<span class="op">*</span>(t<span class="op">**</span><span class="dv">3</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    xyt_2 <span class="op">=</span> x<span class="op">*</span>y<span class="op">*</span>(t<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    xy_2t <span class="op">=</span> x<span class="op">*</span>(y<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>t</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    x_2yt <span class="op">=</span> (x<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>y<span class="op">*</span>t</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    temp_input <span class="op">=</span> torch.cat((x,y,t,x_2,y_2,xy,t_2,xt,yt,x_4,y_4,t_4,x_3y,xy_3,x_2y_2,x_3t,x_2t_2,xt_3,y_3t,y_2t_2,yt_3,xyt_2,xy_2t,x_2yt,x_3,y_3,xy_2,x_2y,xyt,x_2t,y_2t,t_3),<span class="dv">1</span>)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    w<span class="op">=</span>network(temp_input)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> w</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, I build and train the network.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> NeuralNetwork2()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>optimizer2 <span class="op">=</span> torch.optim.SGD(model2.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>, momentum<span class="op">=</span><span class="fl">.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">100000</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>loss_values <span class="op">=</span> np.zeros(<span class="dv">100000</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> loss2(x, y, t, xbdry, ybdry, tbdry, model2)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    l.backward()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    optimizer2.step()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    optimizer2.zero_grad()</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    loss_values[i]<span class="op">=</span>l</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i<span class="op">%</span><span class="dv">1000</span><span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Loss at epoch </span><span class="sc">{}</span><span class="st">: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(i, l.item()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss at epoch 0: 0.89188551902771
Loss at epoch 1000: 0.003854417707771063
Loss at epoch 2000: 0.0035820240154862404
Loss at epoch 3000: 0.003396423067897558
Loss at epoch 4000: 0.0032313335686922073
Loss at epoch 5000: 0.003081361996009946
Loss at epoch 6000: 0.0029437472112476826
Loss at epoch 7000: 0.0028166514821350574
Loss at epoch 8000: 0.0026987330056726933
Loss at epoch 9000: 0.002588952425867319
Loss at epoch 10000: 0.002486460143700242
Loss at epoch 11000: 0.0023905490525066853
Loss at epoch 12000: 0.0023006070405244827
Loss at epoch 13000: 0.0022161088418215513
Loss at epoch 14000: 0.002136589726433158
Loss at epoch 15000: 0.0020616455003619194
Loss at epoch 16000: 0.0019909129478037357
Loss at epoch 17000: 0.001924069132655859
Loss at epoch 18000: 0.0018608317477628589
Loss at epoch 19000: 0.0018009372288361192
Loss at epoch 20000: 0.0017441592644900084
Loss at epoch 21000: 0.001690280856564641
Loss at epoch 22000: 0.0016391162062063813
Loss at epoch 23000: 0.0015904909232631326
Loss at epoch 24000: 0.0015442450530827045
Loss at epoch 25000: 0.0015002338914200664
Loss at epoch 26000: 0.0014583258889615536
Loss at epoch 27000: 0.0014183972962200642
Loss at epoch 28000: 0.0013803349575027823
Loss at epoch 29000: 0.0013440358452498913
Loss at epoch 30000: 0.0013093998422846198
Loss at epoch 31000: 0.0012763398699462414
Loss at epoch 32000: 0.0012447721092030406
Loss at epoch 33000: 0.0012146164663136005
Loss at epoch 34000: 0.0011857992503792048
Loss at epoch 35000: 0.0011582525912672281
Loss at epoch 36000: 0.0011319173499941826
Loss at epoch 37000: 0.0011067262385040522
Loss at epoch 38000: 0.001082623261027038
Loss at epoch 39000: 0.001059556845575571
Loss at epoch 40000: 0.0010374787962064147
Loss at epoch 41000: 0.0010163375409319997
Loss at epoch 42000: 0.000996090704575181
Loss at epoch 43000: 0.0009766991715878248
Loss at epoch 44000: 0.0009581181220710278
Loss at epoch 45000: 0.0009403128060512245
Loss at epoch 46000: 0.0009232479496859014
Loss at epoch 47000: 0.0009068892104551196
Loss at epoch 48000: 0.0008912016055546701
Loss at epoch 49000: 0.0008761570206843317
Loss at epoch 50000: 0.0008617275161668658
Loss at epoch 51000: 0.0008478870149701834
Loss at epoch 52000: 0.0008346029790118337
Loss at epoch 53000: 0.0008218575385399163
Loss at epoch 54000: 0.0008096238598227501
Loss at epoch 55000: 0.0007978778448887169
Loss at epoch 56000: 0.0007866068044677377
Loss at epoch 57000: 0.0007757834391668439
Loss at epoch 58000: 0.0007653866778127849
Loss at epoch 59000: 0.0007554012699984014
Loss at epoch 60000: 0.0007458093459717929
Loss at epoch 61000: 0.0007365943747572601
Loss at epoch 62000: 0.0007277417462319136
Loss at epoch 63000: 0.0007192345801740885
Loss at epoch 64000: 0.0007110605365596712
Loss at epoch 65000: 0.0007032029679976404
Loss at epoch 66000: 0.0006956501747481525
Loss at epoch 67000: 0.0006883873138576746
Loss at epoch 68000: 0.0006814048392698169
Loss at epoch 69000: 0.0006746951257809997
Loss at epoch 70000: 0.0006682390812784433
Loss at epoch 71000: 0.0006620289059355855
Loss at epoch 72000: 0.0006560610490851104
Loss at epoch 73000: 0.0006503157783299685
Loss at epoch 74000: 0.0006447912310250103
Loss at epoch 75000: 0.0006394768133759499
Loss at epoch 76000: 0.0006343616987578571
Loss at epoch 77000: 0.0006294394261203706
Loss at epoch 78000: 0.0006247067940421402
Loss at epoch 79000: 0.0006201465730555356
Loss at epoch 80000: 0.0006157630705274642
Loss at epoch 81000: 0.0006115416181273758
Loss at epoch 82000: 0.0006074761622585356
Loss at epoch 83000: 0.0006035627448000014
Loss at epoch 84000: 0.0005997983971610665
Loss at epoch 85000: 0.0005961735732853413
Loss at epoch 86000: 0.000592682627029717
Loss at epoch 87000: 0.000589318631682545
Loss at epoch 88000: 0.0005860833334736526
Loss at epoch 89000: 0.0005829664296470582
Loss at epoch 90000: 0.0005799678037874401
Loss at epoch 91000: 0.0005770765710622072
Loss at epoch 92000: 0.0005742927896790206
Loss at epoch 93000: 0.0005716124433092773
Loss at epoch 94000: 0.0005690286634489894
Loss at epoch 95000: 0.0005665384232997894
Loss at epoch 96000: 0.0005641438765451312
Loss at epoch 97000: 0.0005618334980681539
Loss at epoch 98000: 0.0005596067057922482
Loss at epoch 99000: 0.0005574636743403971</code></pre>
</div>
</div>
<p>Evidently, the convergence to a solution is much more rapid (one needs far fewer epochs to obtain the same loss as in the more traditional neural network). Below are plots of the solution, as well as an animation. These look virtually identical to the results using the more traditional neural network.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>x_test, y_test, z_test, xbdry_test, ybdry_test, zbdry_test <span class="op">=</span> SampleFromUnitBall(<span class="dv">10000</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_points2(time_index):</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        soln <span class="op">=</span> network_value(x_test,y_test,torch.ones(<span class="dv">10000</span>).unsqueeze(<span class="dv">1</span>)<span class="op">*</span>time_index<span class="op">/</span><span class="dv">100</span>,model2)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    plt.scatter(x<span class="op">=</span>x_test.detach(),y<span class="op">=</span>y_test.detach(),c<span class="op">=</span>soln.detach(), vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Solution at time index "</span> <span class="op">+</span> <span class="bu">str</span>(time_index))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"x-axis"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"y-axis"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>plot_points2(<span class="dv">0</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>plot_points2(<span class="dv">3</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>plot_points2(<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Heat Equation_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Heat Equation_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Heat Equation_files/figure-html/cell-18-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>Interestingly, projecting the solution into the future past <span class="math inline">\(t=0.09\)</span> seems to yield a less accurate solution than the one I got from the neural network. But still, this isn’t bad and leads to some interesting theoretical questions as to the degree of polynomial required to get “future in time” predictions which are as accurate as the network.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>x_test, y_test, z_test, xbdry_test, ybdry_test, zbdry_test <span class="op">=</span> SampleFromUnitBall(<span class="dv">10000</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>):</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        soln <span class="op">=</span> network_value(x_test,y_test,torch.ones(<span class="dv">10000</span>).unsqueeze(<span class="dv">1</span>)<span class="op">*</span>k<span class="op">/</span><span class="dv">100</span>,model2)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    ax.cla()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    ax.scatter(x<span class="op">=</span>x_test.detach(),y<span class="op">=</span>y_test.detach(),c<span class="op">=</span>soln.detach(), vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="fl">0.35</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    display(fig)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    clear_output(wait <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    plt.pause(<span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Heat Equation_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now that I have all of this set up, it would be interesting to run the code against more complicated initial conditions. I leave this exercise to the reader. Next time, I think I’ll get back to something more like the Poisson equation, or perhaps work on solving PDEs which arise from variational problems. Overall, solving PDEs using neural networks or polynomial regression is proving productive and interesting!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>